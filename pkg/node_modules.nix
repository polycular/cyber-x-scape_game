{ stdenvNoCC, lib, nodejs }:

stdenvNoCC.mkDerivation rec {
  __noChroot = true;
  name = "node_modules";
  package = ../assets/package.json;
  lockfile = ../assets/package-lock.json;
  nativeBuildInputs = [
    nodejs
  ];
  builder = builtins.toFile "builder.sh" ''
    source $stdenv/setup

    ln -s $package package.json
    ln -s $lockfile package-lock.json

    HOME=.
    npm ci --no-progress --no-fund --no-audit --no-update-notifier --loglevel error

    mkdir $out
    cp -r node_modules/. $out
  '';

  impureEnvVars = lib.fetchers.proxyImpureEnvVars;
}
